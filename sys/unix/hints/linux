#
# NetHack 3.6  linux $NHDT-Date: 1432512814 2015/05/25 00:13:34 $  $NHDT-Branch: master $:$NHDT-Revision: 1.12 $
# Copyright (c) Kenneth Lorber, Kensington, Maryland, 2007.
# NetHack may be freely redistributed.  See license for details. 
#
#-PRE
# Linux hints file
# This hints file provides a single-user tty build for Linux, specifically
# for Ubuntu dapper.

# 1. Which window system(s) should be included in this binary?
#WANT_WIN_TTY=1
#WANT_WIN_X11=1
#WANT_WIN_QT3=1  # Qt 3
#WANT_WIN_QT4=1  # Qt 4 or 5
#WANT_WIN_SDL2=1
WANT_WIN_CURSES=1

# 1a. What is the default window system?
#WANT_DEFAULT=tty
#WANT_DEFAULT=X11
#WANT_DEFAULT=Qt    # 3, 4 or 5
#WANT_DEFAULT=sdl2
WANT_DEFAULT=curses

# For Qt, define this if linking to Qt 5
HAVE_QT5=1

# For Qt 3, 4 or 5:
# If pkg-config correctly locates the Qt installation, and the correct moc
# is in /usr/bin, this can probably be left as is; otherwise this should point
# to the root of the Qt installation
QTDIR = /usr
# Path to moc
MOC = $(QTDIR)/bin/moc-qt5

# For curses, define this if a wide ncurses is not installed
#NO_WIDE_CURSES=1

# For all tiled window systems: define this to support PNG
WANT_PNG=1

# For all tiled window systems: define this to support XPM
WANT_XPM=1

#PREFIX=/usr
PREFIX=$(wildcard ~)/nh/install
HACKDIR=$(PREFIX)/games/lib/$(GAME)dir
SHELLDIR = $(PREFIX)/games
INSTDIR=$(HACKDIR)
VARDIR = $(HACKDIR)

ifdef WANT_WIN_X11
  HAVE_GUI=1
endif
ifdef WANT_WIN_QT3
  HAVE_GUI=1
endif
ifdef WANT_WIN_QT4
  HAVE_GUI=1
endif
ifdef WANT_WIN_SDL2
  HAVE_GUI=1
endif
ifndef HAVE_GUI
  undefine WANT_PNG
  undefine WANT_XPM
endif

POSTINSTALL=cp -n sys/unix/sysconf $(INSTDIR)/sysconf; $(CHOWN) $(GAMEUID) $(INSTDIR)/sysconf; $(CHGRP) $(GAMEGRP) $(INSTDIR)/sysconf; chmod $(VARFILEPERM) $(INSTDIR)/sysconf;

CFLAGS=-O2 -Wall -I../include -DNOTPARMDECL $(CFLAGS1) -DDEFAULT_WINDOW_SYS=\"$(WANT_DEFAULT)\" -DDLB -DNOUSER_SOUNDS -DSTATUES_LOOK_LIKE_MONSTERS
CFLAGS1=-DCOMPRESS=\"/bin/gzip\" -DCOMPRESS_EXTENSION=\".gz\"
CFLAGS+=-DSYSCF -DSYSCF_FILE=\"$(HACKDIR)/sysconf\" -DSECURE
CFLAGS+=-DHACKDIR=\"$(HACKDIR)\"
ifdef WANT_PNG
    CFLAGS += -DHAVE_PNG $(shell pkg-config --cflags libpng)
endif
ifdef WANT_XPM
    CFLAGS += -DHAVE_XPM $(shell pkg-config --cflags xpm)
endif

LINK=$(CC)
# Only needed for GLIBC stack trace:
LFLAGS=-rdynamic

ifdef WANT_WIN_TTY
WINSRC += $(WINTTYSRC)
WINOBJ0 += $(WINTTYOBJ)
WINLIB += $(WINTTYLIB)

WINTTYLIB=-lcurses
else	# !WANT_WIN_TTY
CFLAGS += -DNOTTYGRAPHICS
endif	# !WANT_WIN_TTY

ifdef WANT_WIN_CURSES
WINSRC = $(WINCURSESSRC)
WINOBJ0 = $(WINCURSESOBJ)
WINLIB = $(WINCURSESLIB)
ifdef NO_WIDE_CURSES
    WINTTYLIB=-lncurses
    CFLAGS += -DCURSES_GRAPHICS -DNO_WIDE_CURSES
else
    WINTTYLIB=-lncursesw
    CFLAGS += -DCURSES_GRAPHICS
endif
endif	# !WANT_WIN_CURSES

ifdef WANT_WIN_X11
    POSTINSTALL+= bdftopcf win/X11/nh10.bdf > $(INSTDIR)/nh10.pcf; (cd $(INSTDIR); mkfontdir);
    CFLAGS += -DX11_GRAPHICS
    WINSRC += $(WINX11SRC)
    WINOBJ0 += $(WINX11OBJ)
    WINLIB += $(WINX11LIB)
    VARDATND = nhtiles.bmp NetHack.ad pet_mark.xbm pilemark.xbm
endif

ifdef WANT_WIN_QT3
    CFLAGS += -DQT_GRAPHICS -DQT_NO_SOUND -fPIC $(shell pkg-config --cflags qt)
    WINSRC += $(WINQTSRC)
    WINOBJ0 += $(WINQTOBJ)
    WINLIB += $(shell pkg-config --libs qt) -fPIC
    LINK=$(CXX)
    VARDATND += nhtiles.bmp rip.xpm
endif

ifdef WANT_WIN_QT4
    ifdef HAVE_QT5
        QT_PACKAGES = Qt5Gui Qt5Widgets
    else
        QT_PACKAGES = QtGui
    endif
    CFLAGS += -DQT_GRAPHICS -DQT_NO_SOUND -fPIC $(shell pkg-config --cflags $(QT_PACKAGES))
    WINSRC += $(WINQT4SRC)
    WINOBJ0 += $(WINQT4OBJ)
    WINLIB += $(shell pkg-config --libs $(QT_PACKAGES)) -fPIC
    LINK=$(CXX)
    VARDATND += nhtiles.bmp rip.xpm
endif # WANT_WIN_QT4

ifdef WANT_WIN_SDL2
CFLAGS += -DSDL2_GRAPHICS -DPOSITIONBAR $(shell pkg-config --cflags pangoft2) $(shell sdl2-config --cflags)
WINSRC += $(WINSDL2SRC)
WINOBJ0 += $(WINSDL2OBJ)
WINLIB += $(WINSDL2LIB) $(shell pkg-config --libs pangoft2) $(shell sdl2-config --libs)
LINK=$(CXX)
VARDATND += nhtiles.bmp
endif # WANT_WIN_SDL2

ifdef WANT_PNG
WINLIB += $(shell pkg-config --libs libpng)
endif
ifdef WANT_XPM
WINLIB += $(shell pkg-config --libs xpm)
endif

# prevent duplicate tile.o in WINOBJ
WINOBJ = $(sort $(WINOBJ0))

CHOWN=true
CHGRP=true

VARDIRPERM = 0755
VARFILEPERM = 0600
GAMEPERM = 0755
